import React, { useState, useEffect } from 'react';

// --- Mock API ---
// This object simulates your backend API to make the component runnable.
// In a real application, you would replace these calls with `fetch()`.
const mockApi = {
    getReportTypes: async () => {
        console.log("API: Fetching report types...");
        return new Promise(resolve => setTimeout(() => resolve({
            success: true,
            data: [
                { reportName: "Monthly Financial Summary (PDF)", fileName: "financial_summary_pdf" },
                { reportName: "User Activity Log (TXT)", fileName: "user_activity_txt" },
                { reportName: "Sales Performance Chart (PNG)", fileName: "sales_chart_png" },
                { reportName: "Quarterly Expense Report (XLSX)", fileName: "quarterly_expense_xlsx" },
            ]
        }), 500));
    },
    downloadReport: async (fileName, date, roleId) => {
        console.log(`API: Downloading report: ${fileName} for date: ${date} with roleId: ${roleId}`);
        return new Promise(resolve => {
            let responseData = {};
            switch (fileName) {
                case "financial_summary_pdf":
                    responseData = {
                        fileName: "financial_summary_20251016.pdf",
                        fileType: "application/pdf",
                        fileContent: "JVBERi0xLjcKJeLjz9MKMSAwIG9iago8PC9UeXBlIC9DYXRhbG9nL1BhZ2VzIDIgMCBSL0xhbmcgKGVuLVVTKSAvU3RydWN0VHJlZVJvb3QgMTIgMCBSL01hcmtJbmZvIDw8L01hcmtlZCB0cnVlPj4+PgplbmRvYmoKMiAwIG9iago8PC9UeXBlIC9QYWdlcy9Db3VudCAxL0tpZHMgWyAzIDAgUiBdPj4KZW5kb2JqCjMgMCBvYmoKPDwvVHlwZSAvUGFnZS9QYXJlbnQgMiAwIFIvUmVzb3VyY2VzIDw8L0ZvbnQgPDwvRjEgNSAwIFI+Pi9YT2JqZWN0IDw8L0ltYWdlMSA5IDAgUj4+L1Byb2NTZXQgWyAvUERGLyBUZXh0L0ltYWdlQiAvSW1hZ2VDL0ltYWdlSSBdPj4vTWVkaWFCb3ggWzAgMCA1OTUuMzIgODQxLjg5XS9Db250ZW50cyA0IDAgUi9Hcm91cCA8PC9UeXBlIC9Hcm91cC9TL1RyYW5zcGFyZW5jeS9DUyAvRGV2aWNlUkdCPj4vVGFicyAvUy9TdHJ1Y3RQYXJlbnRzIDA+PgplbmRvYmoKNCAwIG9iago8PC9GaWx0ZXIgL0ZsYXRlRGVjb2RlL0xlbmd0aCAxMTg+PgpzdHJlYW0KeJwr5HCr5lBQ4FBU4ABiE0B8GhLDk5V0DYyMfHR1TVdXNTCwUbBV0DWMDQwMTAyMNTQ1VdJRyCjKTy1ySSxLzU3RKyxOzi/NKwYyNYx1gRyNDQyNrAwNzEwMLYyMlXSUcosyU1PzyzJSFXIULAAAtNoe0gplbmRzdHJlYW0KZW5kb2JqCjUgMCBvYmoKPDwvVHlwZSAvRm9udC9TdWJ0eXBlIC9UeXBlMS9OYW1lIC9GMS9CYXNlRm9udCAvVGltZXMtUm9tYW4vRW5jb2RpbmcgL1dpbkFuc2lFbmNvZGluZz4+CmVuZG9iago2IDAgb2JqCjw8L1MgL0QvVCAoQk9PS01BUktTKSAvRmlyc3QgNyAwIFIvTGFzdCA4IDAgUi9Db3VudCAyPj4KZW5kb2JqCjcgMCBvYmoKPDwvVGl0bGUgKEFjdXJhKQovQSA8PC9TIC9HaVByaW50L0QvUGFnZSAxPj4vTmV4dCA4IDAgUj4+CmVuZG9iago4IDAgb2JqCjw8L1RpdGxlIChBcG9s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P/w/+z/5f/Z/9v/Q//b/9P/w//T/9P/w/+z/6P/x/+n/uf/d/8n/2f/R/9P/0/+z/6P/k//b/8P/2/9H/wf/Z/8n/wf/j/8f/t/+H/3f/b/8H/y/+r/6f/p/9n/wf/L/9P/w//D/9P/w/+z/5f/Z/9v/Q//b/9P/w//T/9P/w/+z/6P/x/+n/uf/d/8n/2f/R/9P/0/+z/6P/k//b/8P/2/9H/wf/Z/8n/wf/j/8f/t/+H/3f/b/8H/y/+r/6f/p/9n/wf/L/9P/w//D/9P/w/+z/5f/Z/9v/Q//b/9P/w//T/9P/w/+z/6P/x/+n/uf/d/8n/2f/R/9P/0/+z/6P/k//b/8P/2/9H/wf/Z/8n/wf/j/8f/t/+H/3f/b/8H/y/+r/6f/p/9n/wf/L/9P/w//D/9P/w/+z/5f/Z/9v/Q//b/9P/w//T/9P/w/+z/6P/x/+n/uf/d/8n/2f/R/9P/0/+z/6P/k//b/8P/2/9H/wf/Z/8n/wf/j/8f/t/+H/3f/b/8H/y/+r/6f/p/9n/wf/L/9P/w//D/9P/w/+z/5f/Z/9v/Q//b/9P/w//T/9P/w/+z/6P/x/+n/uf/d/8n/2f/R/9P/0/+z/6P/k//b/8P/2/9H/wf/Z/8n/wf/j/8f/t/+H/3f/b/8H/y/+r/6f/p/9n/wf/L/9P/w//D/9P/w/+z/5f/Z/9v/Q//b/9P/w//T/9P/w/+z/6P/x/+n/uf/d/8n/2f/R/9P/0/+z/6P/k//b/8P/2/9H/wf/Z/8n/wf/j/8f/t/+H/3f/b/8H/y/+r/6f/p/9n/wf/L/9P/w//D/9P/w/+z/5f/Z/9v/Q//b/9P/w//T/9P/w/+z/6P/x/+n/uf/d/8n/2f/R/9P/0/+z/6P/k//b/8P/2/9H/wf/Z/8n/wf/j/8f/t/+H/3f/b/8H/y/+r/6f/p/9n/wf/L/9P/w//D/9P/w/+z/5f/Z/9v/Q//b/9P/w//T/9P/w/+z/6P/x/+n/uf/d/8n/2f/R/9P/0/+z/6P/k//b/8P/2/9H/wf/Z/8n/wf/j/8f/t/+H/3f/b/8H/y/+r/6f/p/9n/wf/L/9P/w//D/9P/w/+z/5f/Z/9v/Q//b/9P/w//T/9P/w/+z/6P/x/+n/uf/d/8n/2f/R/9P/0/+z/6P/k//b/8P/2/9H/wf/Z/8n/wf/j/8f/t/+H/3f/b/8H/y/+r/6f/p/9n/wf/L/9P/w//D/9P/w/+z/5f/Z/9v/Q//b/9P/w//T/9P/w/+z/6P/x/+n/uf/d/8n/2f/R/9P/0/+z/6P/k//b/8P/2/9H/wf/Z/8n/wf/j/8f/t/+H/3f/b/8H/y/+r/6f/p/9n/wf/L/9P/w//D/9P/w/+z/5f/Z/9v/Q//b/9P/w//T/9P/w/+z/6P/x/+n/uf/d/8n/2f/R/9P/0/+z/6P/k//b/8P/2/9H/wf/Z/8n/wf/j/8f/t/+H/3f/b/8H/y/+r/6f/p/9n/wf/L/9P/w//D/9P/w/+z/5f/Z/9v/Q//b/9P/w//T/9P/w/+z/6P/x/+n/uf/d/8n/2f/R/9P/0/+z/6P/k//b/8P/2/9H/wf/Z/8n/wf/j/8f/t/+H/3f/b/8H/y/+r/6f/p/9n/wf/L/9P/w//D/9P/w/+z/5f/Z/9v/Q//b/9P/w//T/9P/w/+z/6P/x/+n/uf/d/8n/2f/R/9P/0/+z/6P/k//b/8P/2/9H/wf/Z/8n/wf/j/8f/t/+H/3f/b/8H/y/+r/6f/p/9n/wf/L/9P/w//D/9P/w/+z/5f/Z/9v/Q//b/9P/w//T/9P/w/+z/6P/x/+n/uf/d/8n/2f/R/9P/0/+z/6P/k//b/8P/2/9H/wf/Z/8n/wf/j/8f/t/+H/3f/b/8H/y/+r/6f/p/9n/wf/L/9P/w//D/9P/w/+z/5f/Z/9v/Q//b/9P/w//T/9P/w/+z/6P/x/+n/uf/d/8n/2f/R/9P/0/+z/6P/k//b/8P/2/9H/wf/Z/8n/wf/j/8f/t/+H/3f/b/8H/y/+r/6f/p/9n/wf/L/9P/w//D/9P/w/+z/5f/Z/9v/Q//b/9P/w//T/9P/w/+z/6P/x/+n/uf/d/8n/2f/R/9P/0/+z/6P/k//b/8P/2/9H/wf/Z/8n/wf/j/8f/t/+H/3f/b/8H/y/+r/6f/p/9n/wf/L/9P/w//D/9P/w/+z/5f/Z/9v/Q//b/9P/w//T/9P/w/+z/6P/x/+n/uf/d/8n/2f/R/9P/0/+z/6P/k//b/8P/2/9H/wf/Z/8n/wf/j/8f/t/+H/3f/b/8H/y/+r/6f/p/9n/wf/L/9P/w//D/9P/w/+z/5f/Z/9v/Q//b/9P/w//T/9P/w/+z/6P/x/+n/uf/d/8n/2f/R/9P/0/+z/6P/k//b/8P/2/9H/wf/Z/8n/wf/j/8f/t/+H/3f/b/8H/y/+r/6gplbmRzdHJlYW0KZW5kb2JqCjEyIDAgb2JqCjw8L1R5cGUgL1N0cnVjdFRyZWVSb290L0sgWyA2IDAgUiBdL1BhcmVudFRyZWUgMTEgMCBSL1JvbGVNYXAgPDwvRG9jdW1lbnQgL0RvY3VtZW50L0gxIC9IMS9OIDAgL1A0IC9QND4+Pj4KZW5kb2JqCnhyZWYKMCAxMwowMDAwMDAwMDAwIDY1NTM1IGYgCjAwMDAwMDAwMTUgNjU1MzUgZiAKMDAwMDAwMDA5MyA2NTUzNSBmIAowMDAwMDAwMTQ5IDY1NTM1IGYgCjAwMDAwMDAzODIgNjU1MzUgZiAKMDAwMDAwMDUyMCA2NTUzNSBmIAowMDAwMDAwNjI4IDY1NTM1IGYgCjAwMDAwMDA2OTcgNjU1MzUgZiAKMDAwMDAwMDc1NyA2NTUzNSBmIAowMDAwMDAwODMyIDY1NTM1IGYgCjAwMDAwMDA5NzEgNjU1MzUgZiAKMDAwMDAwMTAxNiA2NTUzNSBmIAowMDAwMDAxMTI0IDY1NTM1IGYgCnRyYWlsZXIKPDwvU2l6ZSAxMy9Sb290IDEgMCBSL0luZm8gPDwvQ3JlYXRvciAoUEhQLVRDUERGLTEuMCk+Pi9JRFsgPDkyOGJjMzY3NzlmNDQ1NmYxYjU2Y2M2YzI4NDFhYzRjPjw5MjhiYzM2Nzc5ZjQ0NTZmMWI1NmNjNmMyODQxYWM0Yz4gXT4+CnN0YXJ0eHJlZgowCiUlRU9GCg=="
                    };
                    break;
                case "user_activity_txt":
                    responseData = {
                        fileName: "user_activity_20251016.txt",
                        fileType: "text/plain",
                        fileContent: btoa("User Activity Log - 2025-10-16\n---------------------------------\n10:05 AM: User 'admin' logged in.\n10:07 AM: User 'admin' accessed financial_summary_pdf.\n11:30 AM: User 'guest' attempted to access quarterly_expense_xlsx. Access denied.\n02:15 PM: User 'admin' logged out.")
                    };
                    break;
                case "sales_chart_png":
                    responseData = {
                        fileName: "sales_chart_20251016.png",
                        fileType: "image/png",
                        fileContent: "iVBORw0KGgoAAAANSUhEUgAAAYAAAAEACAYAAACuLz1IAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41LjbC2k3AAAAon0lEQVR4Xu3dCXhUVdbA8e+kSAi9CRKolxDRBYlYUCwYsSKgiIgK3SuiYkVExV2xGBVERUUEUaSiKy4iiCiKgnRNQS/0AIT0JISSd+/8zuclYRJISmaSmyT3/Xw+hITcnDn3fO/MOfPud85JkyZNmhT8Xn8AAAAAfOq8AAAAAGDqPAAAANB0HgAAAGg6DwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQdDwAAADQ-="
                    };
                    break;
                case "quarterly_expense_xlsx":
                    responseData = {
                        fileName: "quarterly_expense_20251016.xlsx",
                        fileType: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
                        fileContent: "UEsDBBQABgAIAAAAIQAAAAAAAAAAAAAAAAwAAAAdHh0cGFja2FnZS54bWxQSwUGAAAAAAABAAEAAwAAACYAAAAAAA=="
                    };
                    break;
                default:
                    responseData = null;
            }
            setTimeout(() => resolve({ success: !!responseData, data: responseData }), 500);
        });
    }
};

// --- Helper Functions ---

const isViewable = (mimeType) => {
    if (!mimeType) return false;
    return mimeType.startsWith('application/pdf') ||
           mimeType.startsWith('image/') ||
           mimeType.startsWith('text/');
};

const base64ToBlob = (base64, mimeType) => {
    const byteCharacters = atob(base64);
    const byteNumbers = new Array(byteCharacters.length);
    for (let i = 0; i < byteCharacters.length; i++) {
        byteNumbers[i] = byteCharacters.charCodeAt(i);
    }
    const byteArray = new Uint8Array(byteNumbers);
    return new Blob([byteArray], { type: mimeType });
};

// --- Viewer Components ---

const PdfViewer = ({ objectUrl, fileName }) => (
    <iframe src={objectUrl} title={fileName} className="w-full h-full border-0" />
);

const ImageViewer = ({ objectUrl, fileName }) => (
    <div className="w-full h-full flex items-center justify-center p-4 bg-gray-200">
        <img src={objectUrl} alt={fileName} className="max-w-full max-h-full object-contain" />
    </div>
);

const TextViewer = ({ objectUrl }) => {
    const [content, setContent] = useState('');
    useEffect(() => {
        // We need to read the blob content as text to display it
        const reader = new FileReader();
        fetch(objectUrl).then(res => res.blob()).then(blob => {
            reader.readAsText(blob);
            reader.onload = () => setContent(reader.result);
        });
    }, [objectUrl]);

    return (
        <pre className="w-full h-full p-4 bg-gray-800 text-white whitespace-pre-wrap overflow-auto text-sm">
            {content}
        </pre>
    );
};


// --- Main App Component ---

export default function App() {
    const [reportTypes, setReportTypes] = useState([]);
    const [selectedReport, setSelectedReport] = useState('');
    const [reportDate, setReportDate] = useState(new Date().toISOString().split('T')[0]);
    
    const [isLoading, setIsLoading] = useState(false);
    const [error, setError] = useState('');
    
    const [reportData, setReportData] = useState(null);
    const [objectUrl, setObjectUrl] = useState('');
    const [isViewing, setIsViewing] = useState(false);

    // Fetch report types on initial load
    useEffect(() => {
        const loadReportTypes = async () => {
            setIsLoading(true);
            try {
                const response = await mockApi.getReportTypes();
                if (response.success) {
                    setReportTypes(response.data);
                } else {
                    setError('Failed to load report types.');
                }
            } catch (err) {
                setError('An error occurred while fetching report types.');
            } finally {
                setIsLoading(false);
            }
        };
        loadReportTypes();
    }, []);

    // Cleanup object URL when component unmounts or reportData changes
    useEffect(() => {
        return () => {
            if (objectUrl) {
                URL.revokeObjectURL(objectUrl);
            }
        };
    }, [objectUrl]);


    const handleFetchReport = async (e) => {
        e.preventDefault();
        if (!selectedReport || !reportDate) {
            setError('Please select a report and a date.');
            return;
        }
        
        setIsLoading(true);
        setError('');
        setReportData(null);
        setIsViewing(false);
        if (objectUrl) URL.revokeObjectURL(objectUrl);
        setObjectUrl('');

        try {
            // Using a mock roleId for the demo
            const response = await mockApi.downloadReport(selectedReport, reportDate, 101);
            if (response.success && response.data) {
                setReportData(response.data);
            } else {
                setError(`Report '${selectedReport}' not found for the selected date.`);
            }
        } catch (err) {
            setError('An error occurred while fetching the report.');
        } finally {
            setIsLoading(false);
        }
    };

    const handleDownload = () => {
        if (!reportData) return;
        const blob = base64ToBlob(reportData.fileContent, reportData.fileType);
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = reportData.fileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    };

    const handleView = () => {
        if (!reportData) return;
        const blob = base64ToBlob(reportData.fileContent, reportData.fileType);
        const url = URL.createObjectURL(blob);
        setObjectUrl(url);
        setIsViewing(true);
    };

    const renderViewer = () => {
        if (!isViewing || !objectUrl || !reportData) return null;

        const mimeType = reportData.fileType;
        if (mimeType.startsWith('application/pdf')) {
            return <PdfViewer objectUrl={objectUrl} fileName={reportData.fileName} />;
        }
        if (mimeType.startsWith('image/')) {
            return <ImageViewer objectUrl={objectUrl} fileName={reportData.fileName} />;
        }
        if (mimeType.startsWith('text/')) {
            return <TextViewer objectUrl={objectUrl} />;
        }
        return null;
    };

    return (
        <div className="bg-slate-100 min-h-screen font-sans text-slate-800 p-4 sm:p-6 lg:p-8">
            <div className="max-w-6xl mx-auto">
                <header className="mb-8">
                    <h1 className="text-4xl font-bold text-slate-900">Report Dashboard</h1>
                    <p className="text-slate-600 mt-1">Select, fetch, and manage your reports.</p>
                </header>

                <div className="bg-white p-6 rounded-2xl shadow-lg">
                    <form onSubmit={handleFetchReport} className="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                        <div className="flex flex-col">
                            <label htmlFor="report-select" className="mb-1 font-semibold text-slate-700">Report Type</label>
                            <select 
                                id="report-select" 
                                value={selectedReport} 
                                onChange={e => setSelectedReport(e.target.value)}
                                className="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                                disabled={reportTypes.length === 0}
                            >
                                <option value="" disabled>
                                    {reportTypes.length > 0 ? 'Select a report' : 'Loading reports...'}
                                </option>
                                {reportTypes.map(rt => (
                                    <option key={rt.fileName} value={rt.fileName}>{rt.reportName}</option>
                                ))}
                            </select>
                        </div>

                        <div className="flex flex-col">
                            <label htmlFor="report-date" className="mb-1 font-semibold text-slate-700">Date</label>
                            <input 
                                type="date" 
                                id="report-date" 
                                value={reportDate}
                                onChange={e => setReportDate(e.target.value)}
                                className="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                            />
                        </div>

                        <button 
                            type="submit" 
                            disabled={isLoading}
                            className="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition disabled:bg-slate-400 disabled:cursor-not-allowed"
                        >
                            {isLoading ? 'Fetching...' : 'Fetch Report'}
                        </button>
                    </form>
                </div>

                {error && <div className="mt-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg" role="alert">{error}</div>}
                
                {reportData && !isLoading && (
                    <div className="mt-8 bg-white p-6 rounded-2xl shadow-lg">
                        <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center border-b border-slate-200 pb-4 mb-4">
                            <div>
                                <h2 className="text-2xl font-bold text-slate-900">Report Ready</h2>
                                <p className="text-slate-600 font-mono text-sm break-all">{reportData.fileName}</p>
                            </div>
                            <div className="flex space-x-3 mt-4 sm:mt-0">
                                {isViewable(reportData.fileType) && (
                                    <button onClick={handleView} className="bg-indigo-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-indigo-700 transition">
                                        View Report
                                    </button>
                                )}
                                {!isViewable(reportData.fileType) && (
                                    <div className="flex items-center p-2 text-sm text-amber-800 bg-amber-100 rounded-lg">
                                        <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.21 3.03-1.742 3.03H4.42c-1.532 0-2.492-1.696-1.742-3.03l5.58-9.92zM10 13a1 1 0 110-2 1 1 0 010 2zm-1.75-5.25a.75.75 0 00-1.5 0v3.5a.75.75 0 001.5 0v-3.5z" clipRule="evenodd" /></svg>
                                        Viewing not supported
                                    </div>
                                )}
                                <button onClick={handleDownload} className="bg-green-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-green-700 transition">
                                    Download
                                </button>
                            </div>
                        </div>

                        {isViewing && (
                             <div className="mt-4 w-full h-[70vh] bg-slate-200 rounded-lg overflow-hidden border border-slate-300">
                                {renderViewer()}
                            </div>
                        )}
                    </div>
                )}

            </div>
        </div>
    );
}

